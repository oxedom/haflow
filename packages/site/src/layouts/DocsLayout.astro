---
import BaseLayout from './BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getCollection } from 'astro:content';

interface Props {
  title: string;
  description?: string;
}

const { title, description } = Astro.props;

const allDocs = await getCollection('docs');
const sortedDocs = allDocs.sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999));
---

<BaseLayout title={title} description={description}>
  <Header slot="header" />

  <div class="max-w-5xl mx-auto px-4 py-8">
    <div class="flex gap-8">
      <!-- Sidebar -->
      <aside class="w-64 flex-shrink-0 hidden md:block">
        <nav class="sticky top-8">
          <h3 class="text-sm font-bold text-[var(--color-terminal-text-muted)] uppercase tracking-wider mb-4">
            Documentation
          </h3>
          <ul class="space-y-2">
            {sortedDocs.map((doc) => (
              <li>
                <a
                  href={`/docs/${doc.id}`}
                  class="block text-[var(--color-terminal-text-muted)] hover:text-[var(--color-terminal-text)] py-1"
                >
                  {doc.data.title}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </aside>

      <!-- Content -->
      <main class="flex-1 min-w-0">
        <article class="prose prose-invert prose-terminal max-w-none">
          <h1 class="text-3xl font-bold mb-2">{title}</h1>
          {description && (
            <p class="text-[var(--color-terminal-text-muted)] text-lg mb-8">{description}</p>
          )}
          <slot />
        </article>
      </main>
    </div>
  </div>

  <Footer slot="footer" />
</BaseLayout>

<style is:global>
  .prose-terminal {
    --tw-prose-body: var(--color-terminal-text);
    --tw-prose-headings: var(--color-terminal-text);
    --tw-prose-links: var(--color-terminal-cyan);
    --tw-prose-code: var(--color-terminal-amber);
    --tw-prose-pre-bg: var(--color-terminal-bg-light);
  }

  .prose-terminal h2,
  .prose-terminal h3,
  .prose-terminal h4 {
    color: var(--color-terminal-green);
  }

  .prose-terminal code:not(pre code) {
    background: var(--color-terminal-bg-light);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
  }
</style>
